@{
    Layout = "_WelcomeLayout";
    var cardapioUrl = Url.Action("Cardapio", "Home");
}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho - Totem FastFood</title>
    <link rel="stylesheet" href="@Url.Content("~/css/carrinho.css")">
</head>
<body>

    <header>
        
        
    </header>

    <div class="headCar"> 
    <h1> Carrinho de (usuario)</h1>
    <button class="back-btn" onclick="redirecionarCardapio()">← Voltar</button>
    </div>

    <main class="cart-container">
        
        <div class="cart-items">
            <div class="cart-item">
                <img src="~/img/back1.jpg" alt="Whopper">
                <div class="item-info">
                    <h2>Big Css</h2>
                    <p>*sem alface*</p>
                </div>
                <div class="item-price">
                    <p>R$ 27,90</p>
                    <div class="quantity">
                        <button>-</button>
                        <span>1</span>
                        <button>+</button>
                    </div>
                </div>
            </div>
            <p class="edit-item"> <a href="#">Editar Item</a></p>
        </div>

        
        <section class="suggestions">
            <h2>Turbine seu pedido!</h2>
            <div class="suggestions-container">
                <div class="suggestion-item">
                    <img src="~/img/bebidas.png" alt="Free Refill">
                    <p>Free Refill</p>
                    <p>R$ 5,00</p>
                    <button style="
                margin-top: 25px;
            ">+</button>
                </div>
                <div class="suggestion-item">
                    <img src="~/img/d4u1GTvl_kmUrrsUwaj0OV0huie-m7AFB15UzmGDqoU.jpg" alt="Batata Frita Grande">
                    <p>Batata Frita Grande</p>
                    <p>R$ 8,00</p>
                    <button>+</button>
                </div>
                <div class="suggestion-item">
                    <img src="~/img/sobremesas1.jpg" alt="Casquinha Baunilha">
                    <p>Casquinha Baunilha</p>
                    <p>R$ 4,00</p>
                    <button>+</button>
                </div>
            </div>
        </section>
    </main>

    
    <footer class="cart-summary">
        <div class="total">
            <p>Total a pagar:</p>
            <p class="total-price">R$ 27,90</p>
        </div>
        <button class="checkout-btn">Finalizar Pedido</button>
        <p class="cancel-order">Cancelar Pedido</p>
    </footer>

</body>
</html>

<script>
    const cardapioUrl = '@cardapioUrl';

    function redirecionarCardapio() {
        window.location.href = cardapioUrl;
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const itens = JSON.parse(sessionStorage.getItem("itensCarrinho")) || [];
        const container = document.querySelector(".cart-items");
        const totalPreco = document.querySelector(".total-price");

        container.innerHTML = ""; // Limpa conteúdo fixo
        let totalGeral = 0;

        itens.forEach((item, index) => {
            const ingredientes = Object.entries(item.ingredientes)
                .map(([nome, qtd]) => `${qtd}x ${nome}`)
                .join(", ");

            totalGeral += item.total;

            container.innerHTML += `
    <div class="cart-item">
        <img src="${item.imagem}" alt="${item.nome}">
        <div class="item-info">
            <h2>${item.nome}</h2>
            <p>${ingredientes ? ingredientes : "Sem ingredientes extras"}</p>
        </div>
        <div class="item-price">
            <p>R$ ${item.total.toFixed(2).replace(".", ",")}</p>
            <div class="quantity">
                <button onclick="alterarQtd(${index}, -1)">-</button>
                <span>${item.quantidade}</span>
                <button onclick="alterarQtd(${index}, 1)">+</button>
                <p class="edit-item"><a href="#">Editar Item</a></p>
            </div>
        </div>
    </div>
    
`;

        });

        totalPreco.textContent = `R$ ${totalGeral.toFixed(2).replace(".", ",")}`;
    });

    function alterarQtd(index, delta) {
        let itens = JSON.parse(sessionStorage.getItem("itensCarrinho")) || [];
        if (!itens[index]) return;

        itens[index].quantidade += delta;
        if (itens[index].quantidade <= 0) {
            itens.splice(index, 1); // Remove item se quantidade for zero
        } else {
            itens[index].total = itens[index].quantidade * itens[index].precoUnitario;
        }

        sessionStorage.setItem("itensCarrinho", JSON.stringify(itens));

        // Atualiza total
        let totalItens = 0, totalPedido = 0;
        itens.forEach(i => {
            totalItens += i.quantidade;
            totalPedido += i.total;
        });

        sessionStorage.setItem("totalItens", totalItens);
        sessionStorage.setItem("totalPedido", totalPedido.toFixed(2));

        location.reload(); // Recarrega a tela para atualizar os dados
    }
</script>

